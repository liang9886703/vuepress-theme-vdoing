---
title: 一致性算法
date: 2025-02-13 23:10:50
permalink: /02/01
categories: 
  - 02
tags: 
author:
  name: songkuakua
  link: https://github.com/liang9886703
---
# Raft算法

解决分布式消息一致性问题，例如zookeeper

## 原理

每个节点有三种状态：候选人candidate，领导者leader，跟随者状态follower

如果跟随者没有跟随一个领导者则成为候选人

候选人将接收其他节点的投票，如果获得票最多将称为领导者

所有对于系统的改变都要通过领导者同意，每一个改变的添加都将作为log的一个条目加入到节点，此时条目没有提交所以值不会更新，领导者复制条目到每一个跟随者节点，等待大多数节点都传回了写入信息后，条目提交此时改变生效，领导者通知所有跟随者改变生效（跟随者条目提交），这个集群此时状态一致。这个程序称为log复制

领导者选举

在Raft中，有两个控制选举的超时设置。选举超时是跟随者等待的时间过长（约150-300ms）从而变为候选人，开始新的投票，它向其他节点发出投票需求，如果接收的节点还没有投票那么它会投票给这个节点，这个节点会重置选举超时，当候选人有大多数投票，它将称为领导者，发送信息（append entries）向所有跟随者，这个信息是周期性发送的，即心跳超时，跟随者也会回应每一个append entries，每次跟随着接收append entries都会重置选举超时。如果两个节点同时成为候选人则可能发生分裂投票，那么会等待重新开始下一轮投票，最终将选出一个领导者

[Raft算法详解](https://zhuanlan.zhihu.com/p/32052223)

