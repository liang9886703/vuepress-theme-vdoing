(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{385:function(v,_,t){"use strict";t.r(_);var a=t(7),s=Object(a.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"分布式id生成"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分布式id生成"}},[v._v("#")]),v._v(" 分布式ID生成")]),v._v(" "),_("h1",{attrs:{id:"分布式id特点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分布式id特点"}},[v._v("#")]),v._v(" 分布式ID特点")]),v._v(" "),_("ul",[_("li",[v._v("**全局唯一性：**不能出现有重复的ID标识，这是基本要求。")]),v._v(" "),_("li",[v._v("**递增性：**确保生成ID对于用户或业务是递增的。")]),v._v(" "),_("li",[v._v("**高可用性：**确保任何时候都能生成正确的ID。")]),v._v(" "),_("li",[v._v("**高性能性：**在高并发的环境下依然表现良好。")])]),v._v(" "),_("h1",{attrs:{id:"常见策略"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#常见策略"}},[v._v("#")]),v._v(" 常见策略")]),v._v(" "),_("ol",[_("li",[v._v("数据库自增ID。")]),v._v(" "),_("li",[v._v("UUID生成。（不支持自增，ID可读性差）")]),v._v(" "),_("li",[v._v("Redis的原子自增方式。")]),v._v(" "),_("li",[v._v("数据库水平拆分，设置初始值和相同的自增步长。")]),v._v(" "),_("li",[v._v("批量申请自增ID。")]),v._v(" "),_("li",[v._v("雪花算法。")]),v._v(" "),_("li",[v._v("百度UidGenerator算法(基于雪花算法实现自定义时间戳)。")]),v._v(" "),_("li",[v._v("美团Leaf算法(依赖于数据库，ZK)。")])]),v._v(" "),_("h1",{attrs:{id:"雪花算法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#雪花算法"}},[v._v("#")]),v._v(" 雪花算法")]),v._v(" "),_("p",[v._v("在单机上递增，多台机器上大致递增并不是严格递增")]),v._v(" "),_("h2",{attrs:{id:"数据结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据结构"}},[v._v("#")]),v._v(" 数据结构")]),v._v(" "),_("p",[v._v("使用64位数字作为全局唯一ID")]),v._v(" "),_("p",[_("img",{attrs:{src:"/%E5%88%86%E5%B8%83%E5%BC%8F/Untitled.png",alt:"Untitled"}})]),v._v(" "),_("p",[v._v("第一位为0没有作用，")]),v._v(" "),_("p",[v._v("41位时间戳，精确毫秒，可以容纳约69年的时间，")]),v._v(" "),_("p",[v._v("10位工作机器id，高5位为数据中心ID（机房），低5位为工作节点ID（机器），即做多1024台机器")]),v._v(" "),_("p",[v._v("12位序列号ID")]),v._v(" "),_("p",[v._v("在同一毫秒可生成的唯一ID数量=1024*4096")]),v._v(" "),_("h2",{attrs:{id:"时间"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#时间"}},[v._v("#")]),v._v(" 时间")]),v._v(" "),_("p",[v._v("项目开始时间为基准时间")]),v._v(" "),_("p",[v._v("获取ID可以使用位运算")]),v._v(" "),_("p",[_("strong",[v._v("时间回拨问题：")])]),v._v(" "),_("p",[v._v("需要场景：人为改变、不同机器上时间同步，")]),v._v(" "),_("p",[v._v("解决：")]),v._v(" "),_("p",[v._v("回拨时间小的时候，不生成ID，阻塞等待时间点到达")]),v._v(" "),_("p",[v._v("利用拓展位，回拨后在拓展位上加1，但需要提前预留拓展位（序列号或机器ID）")]),v._v(" "),_("h3",{attrs:{id:"计算"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#计算"}},[v._v("#")]),v._v(" 计算")]),v._v(" "),_("p",[v._v("计算下一个ID：")]),v._v(" "),_("p",[v._v("判断序列号满了没（与最大序列化作与运算），满了则等到下一个时间戳")]),v._v(" "),_("p",[v._v("对应的值移位，再或运算加到一起")])])}),[],!1,null,null,null);_.default=s.exports}}]);