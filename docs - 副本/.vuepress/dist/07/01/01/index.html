<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IP | 松垮垮</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="后端开发等技术文章。">
    <meta name="keywords" content="后端博客,个人技术博客,后端,后端开发,后端框架,后端面试题,技术文档,学习,面试,c++,git,github">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.4229948e.css" as="style"><link rel="preload" href="/assets/js/app.41210a84.js" as="script"><link rel="preload" href="/assets/js/2.ddcc22d9.js" as="script"><link rel="preload" href="/assets/js/3.9a514af0.js" as="script"><link rel="preload" href="/assets/js/35.a1680b5b.js" as="script"><link rel="prefetch" href="/assets/js/10.c5ea2586.js"><link rel="prefetch" href="/assets/js/11.345c12e4.js"><link rel="prefetch" href="/assets/js/12.7bd611a3.js"><link rel="prefetch" href="/assets/js/13.e31f4e59.js"><link rel="prefetch" href="/assets/js/14.6cd7ac12.js"><link rel="prefetch" href="/assets/js/15.9d43ec16.js"><link rel="prefetch" href="/assets/js/16.96ef5845.js"><link rel="prefetch" href="/assets/js/17.930177fa.js"><link rel="prefetch" href="/assets/js/18.693f6f3c.js"><link rel="prefetch" href="/assets/js/19.e757fc80.js"><link rel="prefetch" href="/assets/js/20.ed5c437a.js"><link rel="prefetch" href="/assets/js/21.c41265c1.js"><link rel="prefetch" href="/assets/js/22.ed241c46.js"><link rel="prefetch" href="/assets/js/23.7a084215.js"><link rel="prefetch" href="/assets/js/24.2e695667.js"><link rel="prefetch" href="/assets/js/25.3a8e1528.js"><link rel="prefetch" href="/assets/js/26.a630eff6.js"><link rel="prefetch" href="/assets/js/27.a26a85aa.js"><link rel="prefetch" href="/assets/js/28.532ed3b7.js"><link rel="prefetch" href="/assets/js/29.fa09431b.js"><link rel="prefetch" href="/assets/js/30.0fbcfcdc.js"><link rel="prefetch" href="/assets/js/31.b7ca18e2.js"><link rel="prefetch" href="/assets/js/32.51e3797a.js"><link rel="prefetch" href="/assets/js/33.c79407e6.js"><link rel="prefetch" href="/assets/js/34.c1709f1a.js"><link rel="prefetch" href="/assets/js/36.4692c6d1.js"><link rel="prefetch" href="/assets/js/37.1caefdec.js"><link rel="prefetch" href="/assets/js/38.158e350f.js"><link rel="prefetch" href="/assets/js/39.a64bf6b9.js"><link rel="prefetch" href="/assets/js/4.ce7d70a4.js"><link rel="prefetch" href="/assets/js/40.def4302a.js"><link rel="prefetch" href="/assets/js/41.d8026554.js"><link rel="prefetch" href="/assets/js/42.496b6914.js"><link rel="prefetch" href="/assets/js/43.67cc445d.js"><link rel="prefetch" href="/assets/js/44.3f5aa743.js"><link rel="prefetch" href="/assets/js/45.ea91ad4f.js"><link rel="prefetch" href="/assets/js/46.80d186c9.js"><link rel="prefetch" href="/assets/js/47.ecf0e135.js"><link rel="prefetch" href="/assets/js/48.001b8a90.js"><link rel="prefetch" href="/assets/js/49.7d13e977.js"><link rel="prefetch" href="/assets/js/5.a0af7f8a.js"><link rel="prefetch" href="/assets/js/50.c78d144d.js"><link rel="prefetch" href="/assets/js/51.d0c87914.js"><link rel="prefetch" href="/assets/js/52.11fa1467.js"><link rel="prefetch" href="/assets/js/53.f05510d9.js"><link rel="prefetch" href="/assets/js/54.5800936b.js"><link rel="prefetch" href="/assets/js/55.ffc15fea.js"><link rel="prefetch" href="/assets/js/56.88e0791b.js"><link rel="prefetch" href="/assets/js/57.86abaef0.js"><link rel="prefetch" href="/assets/js/58.ccb34ddc.js"><link rel="prefetch" href="/assets/js/59.39016f6c.js"><link rel="prefetch" href="/assets/js/6.2205d704.js"><link rel="prefetch" href="/assets/js/7.6ae52fc4.js"><link rel="prefetch" href="/assets/js/8.8a6895b8.js"><link rel="prefetch" href="/assets/js/9.10468b6d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4229948e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="松垮垮" class="logo"> <span class="site-name can-hide">松垮垮</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="quicker" class="dropdown-title"><a href="/01/" class="link-title">quicker</a> <span class="title" style="display:none;">quicker</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01/01/" class="nav-link">vim.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/02/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02/01/" class="nav-link">一致性算法.md</a></li><li class="dropdown-item"><!----> <a href="/02/02/" class="nav-link">分布式ID生成.md</a></li><li class="dropdown-item"><!----> <a href="/02/03/" class="nav-link">分布式架构.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/03/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/03/01/" class="nav-link">css.md</a></li><li class="dropdown-item"><!----> <a href="/03/02/" class="nav-link">html.md</a></li><li class="dropdown-item"><!----> <a href="/03/03/" class="nav-link">JavaScript.md</a></li><li class="dropdown-item"><!----> <a href="/03/04/" class="nav-link">vue.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><a href="/04/" class="link-title">操作系统</a> <span class="title" style="display:none;">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/04/01/" class="nav-link">内存管理.md</a></li><li class="dropdown-item"><!----> <a href="/04/02/" class="nav-link">文件系统.md</a></li><li class="dropdown-item"><!----> <a href="/04/03/" class="nav-link">硬件结构.md</a></li><li class="dropdown-item"><!----> <a href="/04/04/" class="nav-link">网络系统.md</a></li><li class="dropdown-item"><!----> <a href="/04/05/" class="nav-link">设备管理.md</a></li><li class="dropdown-item"><!----> <a href="/04/06/" class="nav-link">调试技术.md</a></li><li class="dropdown-item"><!----> <a href="/04/07/" class="nav-link">进程管理.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/05/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/05/01/" class="nav-link">redis原理.md</a></li><li class="dropdown-item"><!----> <a href="/05/02/" class="nav-link">数据库.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器开发" class="dropdown-title"><a href="/06/" class="link-title">服务器开发</a> <span class="title" style="display:none;">服务器开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/06/01/" class="nav-link">nginx.md</a></li><li class="dropdown-item"><!----> <a href="/06/02/" class="nav-link">nginx环境+编译+调试.md</a></li><li class="dropdown-item"><!----> <a href="/06/03/" class="nav-link">高性能linux服务器.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络编程" class="dropdown-title"><a href="/07/" class="link-title router-link-active">网络编程</a> <span class="title" style="display:none;">网络编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/07/01/01/" aria-current="page" class="nav-link router-link-exact-active router-link-active">IP</a></li><li class="dropdown-item"><!----> <a href="/07/02/" class="nav-link">网络工具.md</a></li><li class="dropdown-item"><!----> <a href="/07/03/" class="nav-link">网络编程.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/08/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/08/01/" class="nav-link">GPU并行编程.md</a></li><li class="dropdown-item"><!----> <a href="/08/02/" class="nav-link">mysql.md</a></li><li class="dropdown-item"><!----> <a href="/08/03/" class="nav-link">nginx.md</a></li><li class="dropdown-item"><!----> <a href="/08/04/" class="nav-link">redis.md</a></li><li class="dropdown-item"><!----> <a href="/08/05/" class="nav-link">网络.md</a></li><li class="dropdown-item"><!----> <a href="/08/06/" class="nav-link">计算机视觉.md</a></li><li class="dropdown-item"><!----> <a href="/08/07/" class="nav-link">进程管理.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目bug" class="dropdown-title"><a href="/09/" class="link-title">项目bug</a> <span class="title" style="display:none;">项目bug</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/09/01/" class="nav-link">linux调试.md</a></li><li class="dropdown-item"><!----> <a href="/09/02/" class="nav-link">【Python】：re.error bad escape i at position 4.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/liang9886703" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://jsd.cdn.zzko.cn/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>松垮垮</h3> <span>c++后端开发工程师</span> <span></span> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="quicker" class="dropdown-title"><a href="/01/" class="link-title">quicker</a> <span class="title" style="display:none;">quicker</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01/01/" class="nav-link">vim.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/02/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02/01/" class="nav-link">一致性算法.md</a></li><li class="dropdown-item"><!----> <a href="/02/02/" class="nav-link">分布式ID生成.md</a></li><li class="dropdown-item"><!----> <a href="/02/03/" class="nav-link">分布式架构.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/03/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/03/01/" class="nav-link">css.md</a></li><li class="dropdown-item"><!----> <a href="/03/02/" class="nav-link">html.md</a></li><li class="dropdown-item"><!----> <a href="/03/03/" class="nav-link">JavaScript.md</a></li><li class="dropdown-item"><!----> <a href="/03/04/" class="nav-link">vue.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><a href="/04/" class="link-title">操作系统</a> <span class="title" style="display:none;">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/04/01/" class="nav-link">内存管理.md</a></li><li class="dropdown-item"><!----> <a href="/04/02/" class="nav-link">文件系统.md</a></li><li class="dropdown-item"><!----> <a href="/04/03/" class="nav-link">硬件结构.md</a></li><li class="dropdown-item"><!----> <a href="/04/04/" class="nav-link">网络系统.md</a></li><li class="dropdown-item"><!----> <a href="/04/05/" class="nav-link">设备管理.md</a></li><li class="dropdown-item"><!----> <a href="/04/06/" class="nav-link">调试技术.md</a></li><li class="dropdown-item"><!----> <a href="/04/07/" class="nav-link">进程管理.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/05/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/05/01/" class="nav-link">redis原理.md</a></li><li class="dropdown-item"><!----> <a href="/05/02/" class="nav-link">数据库.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器开发" class="dropdown-title"><a href="/06/" class="link-title">服务器开发</a> <span class="title" style="display:none;">服务器开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/06/01/" class="nav-link">nginx.md</a></li><li class="dropdown-item"><!----> <a href="/06/02/" class="nav-link">nginx环境+编译+调试.md</a></li><li class="dropdown-item"><!----> <a href="/06/03/" class="nav-link">高性能linux服务器.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络编程" class="dropdown-title"><a href="/07/" class="link-title router-link-active">网络编程</a> <span class="title" style="display:none;">网络编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/07/01/01/" aria-current="page" class="nav-link router-link-exact-active router-link-active">IP</a></li><li class="dropdown-item"><!----> <a href="/07/02/" class="nav-link">网络工具.md</a></li><li class="dropdown-item"><!----> <a href="/07/03/" class="nav-link">网络编程.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/08/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/08/01/" class="nav-link">GPU并行编程.md</a></li><li class="dropdown-item"><!----> <a href="/08/02/" class="nav-link">mysql.md</a></li><li class="dropdown-item"><!----> <a href="/08/03/" class="nav-link">nginx.md</a></li><li class="dropdown-item"><!----> <a href="/08/04/" class="nav-link">redis.md</a></li><li class="dropdown-item"><!----> <a href="/08/05/" class="nav-link">网络.md</a></li><li class="dropdown-item"><!----> <a href="/08/06/" class="nav-link">计算机视觉.md</a></li><li class="dropdown-item"><!----> <a href="/08/07/" class="nav-link">进程管理.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目bug" class="dropdown-title"><a href="/09/" class="link-title">项目bug</a> <span class="title" style="display:none;">项目bug</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/09/01/" class="nav-link">linux调试.md</a></li><li class="dropdown-item"><!----> <a href="/09/02/" class="nav-link">【Python】：re.error bad escape i at position 4.md</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/liang9886703" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/07/01/01/" aria-current="page" class="active sidebar-link">IP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/07/01/01/#ip地址的分类" class="sidebar-link">IP地址的分类</a></li><li class="sidebar-sub-header level2"><a href="/07/01/01/#无分类地址cidr" class="sidebar-link">无分类地址CIDR</a></li><li class="sidebar-sub-header level2"><a href="/07/01/01/#公有ip地址与私有ip地址" class="sidebar-link">公有IP地址与私有IP地址</a></li><li class="sidebar-sub-header level2"><a href="/07/01/01/#ip地址与路由控制" class="sidebar-link">IP地址与路由控制</a></li><li class="sidebar-sub-header level2"><a href="/07/01/01/#ip分片与重组" class="sidebar-link">IP分片与重组</a></li><li class="sidebar-sub-header level2"><a href="/07/01/01/#ipv6" class="sidebar-link">IPv6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/07/01/01/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#ipv6地址的结构" class="sidebar-link">IPv6地址的结构</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#单播地址" class="sidebar-link">单播地址</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#ipv6首部与ipv4首部" class="sidebar-link">IPv6首部与IPv4首部</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/07/01/01/#ip协议相关技术" class="sidebar-link">IP协议相关技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/07/01/01/#dns域名解析" class="sidebar-link">DNS域名解析</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#域名的层级关系" class="sidebar-link">域名的层级关系</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#域名解析过程" class="sidebar-link">域名解析过程</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#arp" class="sidebar-link">ARP</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#dhcp" class="sidebar-link">DHCP</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#nat网络地址转换" class="sidebar-link">NAT网络地址转换</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#icmp互联网控制报文协议" class="sidebar-link">ICMP互联网控制报文协议</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#icmp报头格式" class="sidebar-link">ICMP报头格式</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#查询报文类型" class="sidebar-link">查询报文类型</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#差错报文类型" class="sidebar-link">差错报文类型：</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#ping的工作原理" class="sidebar-link">ping的工作原理</a></li><li class="sidebar-sub-header level4"><a href="/07/01/01/#traceroute-差错报文类型的使用" class="sidebar-link">traceroute——差错报文类型的使用</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#igmp因特网组管理协议" class="sidebar-link">IGMP因特网组管理协议</a></li><li class="sidebar-sub-header level3"><a href="/07/01/01/#为什么断网还能ping通127-0-0-1" class="sidebar-link">为什么断网还能ping通127.0.0.1</a></li></ul></li></ul></li><li><a href="/07/01/02/" class="sidebar-link">TCP</a></li><li><a href="/07/01/03/" class="sidebar-link">网络安全</a></li><li><a href="/07/01/04/" class="sidebar-link">HTTP</a></li></ul></section></li><li><a href="/07/02/" class="sidebar-link">网络工具</a></li><li><a href="/07/03/" class="sidebar-link">网络编程</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/07/#网络编程" data-v-06970110>网络编程</a></li><li data-v-06970110><a href="/07/#基础" data-v-06970110>基础</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/liang9886703" target="_blank" title="作者" class="beLink" data-v-06970110>songkuakua</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2025-02-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">IP<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="ip"><a href="#ip" class="header-anchor">#</a> IP</h1> <p>[TOC]</p> <p>使得在复杂的网络环境中将数据包发送给最终目的主机</p> <p><strong>@ IP和MAC（数据链路层）的关系和区别</strong></p> <p>IP的作用是主机之间通信用的，MAC的作用是实现两个设备之间通信，IP则负责在没有直连的两个网络之间进行通信传输，IP指明方向，MAC决定具体怎么走</p> <hr> <p>首先每个设备需要配置正确的IP地址</p> <p>IPv4由32位正整数表示，为方便记忆，将32位IP地址以每8位一组，分为4组转为10进制</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231219112542424.png" alt="image-20231219112542424"></p> <p>IP地址不是以主机台数来配置的，而是以网卡来配置的，通常路由器、服务器都有2个以上的网卡和IP地址</p> <h2 id="ip地址的分类"><a href="#ip地址的分类" class="header-anchor">#</a> IP地址的分类</h2> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231219112829965.png" alt="image-20231219112829965"></p> <p>黄色部分为分类号，用以区分IP地址类别</p> <p>A、B、C类地址分为网络号和主机号两部分。</p> <p>例如对于C类，最大主机个数</p> <img src="image-20231219113012634.png" alt="image-20231219113012634" style="zoom:33%;"> <p>减2是因为两个IP是特殊的，即主机号全为1指定某个网络下的所有主机用于广播，和全为0指定某个网络</p> <p>D类没有主机号，常被用于多播，E类未使用</p> <p><strong>@ 广播地址的作用</strong></p> <p>用于在同一个链路中相互连接的主机之间发送数据包</p> <p><strong>本地广播</strong>：例如网络地址若为192.168.0.0/24，广播地址为192.168.0.255，这个广播地址的IP包会被路由器屏蔽，所以不会到达192.168.0.0/24以外的链路上</p> <p><strong>直接广播：</strong> 192.168.0.0/24 向 192.168.1.255/24发送IP包，收到包的路由器转发给192.168.1.0/24，使得所有192.168.1.1 - 192.168.1.254都能收到这个包（由于直接广播有安全问题，通常设置为不转发）</p> <p>**全局广播：**地址是255.255.255.255，现在不会使用</p> <hr> <p><strong>@ 多播地址的作用</strong></p> <p>用于将包发给特定组内的所有主机</p> <p>广播不能穿透路由，若想给其他网段发送同样的包，可以使用穿透路由的多播</p> <img src="image-20231219134203485.png" alt="image-20231219134203485" style="zoom:50%;"> <p>D类地址</p> <p>4位表示是多播地址，剩下的28位是多播的组编号</p> <ul><li>224.0.0.0 ~ 224.0.0.255 为预留的组播地址，只能在<strong>局域网中</strong>，路由器是不会进行转发的。</li> <li>224.0.1.0 ~ 238.255.255.255 为<strong>用户可用的组播地址</strong>，可以用于 Internet 上。</li> <li>239.0.0.0 ~ 239.255.255.255 为<strong>本地管理组播地址</strong>，可供内部网在内部使用，仅在特定的本地范围内有效。</li></ul> <hr> <p><strong>@ IP分类的优缺</strong></p> <p>优点：简单明了，选路简单</p> <p>缺点：</p> <ol><li>同一网络下没有地址层次，不能再次细分</li> <li>不能很好的与现实网络匹配，C类地址能包含的最大主机数量太少，B类地址的最大主机数又太多</li></ol> <h2 id="无分类地址cidr"><a href="#无分类地址cidr" class="header-anchor">#</a> 无分类地址CIDR</h2> <p>只有两部分，前面是网络号，后面是主机号</p> <p>表示形式 <code>a.b.c.d/x</code>，其中/x表示前x位（0-32）属于网络号，</p> <p>例，10.100.122.2/24表示前24位是网络号，剩余8位为主机号</p> <p>而广播地址是每个子网里最大的那个主机号</p> <p><strong>子网掩码</strong></p> <img src="image-20231219203234730.png" alt="image-20231219203234730" style="zoom:50%;"> <p><strong>@为什么要分离网络号和主机号</strong></p> <p>两台主机通讯先判断是否处于一个广播域中，即网络地址相同表面在同一网络上，可以直接把数据包发给目标主机</p> <p>路由器寻址也是通过这样的方式来找到对应的网络号，把数据包发给对应网络中</p> <hr> <p><strong>@子网划分</strong></p> <p>通过子网掩码划分子网</p> <p>将主机地址分为两个部分：子网网络地址+子网主机地址</p> <p>由于子网网络地址划分为2位，子网地址就有4个，00、01、10、11</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231219205617781.png" alt="image-20231219205617781"></p> <hr> <h2 id="公有ip地址与私有ip地址"><a href="#公有ip地址与私有ip地址" class="header-anchor">#</a> 公有IP地址与私有IP地址</h2> <p>A、B、C分类地址，有分公有IP和私有IP地址</p> <p>个人用户使用私有IP地址，允许组织内部分配管理，不同网络可以重复</p> <p>公有IP由ICANN组织统一分配，保持唯一</p> <h2 id="ip地址与路由控制"><a href="#ip地址与路由控制" class="header-anchor">#</a> IP地址与路由控制</h2> <p>IP地址的网络地址由路由控制，主机和路由器有各自的路由器控制表，路由控制表记录网络地址与下一步发送至路由器的地址</p> <p>发送IP包时，首先确定IP包首部中的目标地址，从路由控制表中找到与该地址相同的网络地址的记录，转发给相应的下一个路由器。如果有多条相同网络地址的记录，则选择相同位数最多的网络地址，即最长匹配</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231220085849389.png" alt="image-20231220085849389"></p> <p>主机A发送一个IP包，源地址是10.1.1.30，目标地址是10.1.2.10</p> <ol><li>由于主机A中的路由表没有找到这个地址，因此将包转发到默认路由器1</li> <li>路由器1收到后，查找自身路由表，把IP数据包转发到10.1.0.2这台路由器2</li> <li>路由器2收到后，查找自身路由表，发现匹配了，把IP包从路由器2的10.1.2.1接口出去，经过交换机把IP数据包转发目标主机</li></ol> <p><strong>@ 环回地址</strong></p> <p>127.0.0.1是特殊地址，是同一台计算机程序之间进行网络通信使用的默认地址</p> <hr> <h2 id="ip分片与重组"><a href="#ip分片与重组" class="header-anchor">#</a> IP分片与重组</h2> <p>每个数据链路的最大传输单元MTU不同（因为有不同用处），以太网是1500，当IP数据包大于MTU时，IP数据包会被分片，重组只能由目标主机完成，路由器不参与</p> <p>由于IP层包分片，其中丢失了一个就会整体重发，所以TCP中引入了MSS，即在TCP做了分片，每个分片小于MTU，不交给IP层分片。对于UDP，尽量不要发送一个大于MTU的数据报文</p> <h2 id="ipv6"><a href="#ipv6" class="header-anchor">#</a> IPv6</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p><strong>优点：</strong></p> <ul><li>128位，有更多的地址，更好的安全性和扩展性</li> <li>自动分配IP地址，即插即用</li> <li>包头包首部采用固定的值40字节，去掉包头校验和，简化了首部结构，减轻了路由器负荷，提高了传输的性能</li> <li>提高了安全性，有应对伪造IP地址的网络安全功能及防止线路窃听的功能</li></ul> <p>但IPv4和IPv6不能兼容，需要设备、网络运营商共同升级，因此普及慢</p> <p><strong>IPv6地址的标识：</strong></p> <p>以16位作为一组，中间用：隔开</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231220092812043.png" alt="image-20231220092812043"></p> <p>出现连续的0可以将其省略，用：：隔开，但一个IP地址只能出现一次这种省略</p> <h3 id="ipv6地址的结构"><a href="#ipv6地址的结构" class="header-anchor">#</a> IPv6地址的结构</h3> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231220093145378.png" alt="image-20231220093145378"></p> <p><strong>环回地址</strong>用于当前主机内的通信，不经过网络</p> <h4 id="单播地址"><a href="#单播地址" class="header-anchor">#</a> 单播地址</h4> <p><strong>全局单播地址</strong>，相当于IPv4的公有IP</p> <p><strong>唯一本地地址</strong>，在内网里播通信（相当IPv4的私有IP），常用于当本地IP未配置时，同一网络内的通信，</p> <p><strong>链路本地单播地址</strong>，同一链路单播通信，不经过路由器（IPv4没有这个地址）</p> <h3 id="ipv6首部与ipv4首部"><a href="#ipv6首部与ipv4首部" class="header-anchor">#</a> IPv6首部与IPv4首部</h3> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231220095304399.png" alt="image-20231220095304399"></p> <ul><li>取消了首部校验和字段：数据链路层和传输层都会校验，因此取消</li> <li>取消了分片/重组相关字段：上层分片重组了，IPv6不允许在中间路由器进行分片重组，只能在源主机和目标主机，大大提高了路由器的转发速度</li> <li>取消选项字段：放入在IPv6首部中的下一个首部指出的位置上，删除该字段使得IPv6的首部为固定的40字节</li></ul> <h2 id="ip协议相关技术"><a href="#ip协议相关技术" class="header-anchor">#</a> IP协议相关技术</h2> <h3 id="dns域名解析"><a href="#dns域名解析" class="header-anchor">#</a> DNS域名解析</h3> <p>比起IP地址，域名更方便人类记忆，DNS可以将域名网址转为具体的IP地址</p> <h4 id="域名的层级关系"><a href="#域名的层级关系" class="header-anchor">#</a> 域名的层级关系</h4> <p>域名用句点来分割，靠右层级越高</p> <ul><li>根DNS服务器</li> <li>顶级域DNS服务器(com 、cn)</li> <li>权威DNS服务器(server.com)</li></ul> <p>根域的DNS服务器信息保存在互联网中所有的DNS服务器中，任何DNS服务器可以找到并访问根域DNS服务器</p> <h3 id="域名解析过程"><a href="#域名解析过程" class="header-anchor">#</a> 域名解析过程</h3> <p>浏览器先查看自己缓存，没有则查看os的缓存，还没有则查看本机域名解析文件hosts，还没有则DNS服务器查询：</p> <ol><li>客户端发出DNS请求给本地DNS服务器（客户端的TCP/IP中填写的DNS服务器地址）</li> <li>本地域名服务器收到客户端请求后，如果缓存的表格能找到，则直接返回IP地址，如果没有则去问它的根域名服务器，根DNS发现后置是.com，则返回.com的顶级域名服务器地址</li> <li>本地DNS收到后请求顶级域名服务器，询问www.server.com，顶级域名服务器给出器的权威DNS服务器的地址</li> <li>本地DNS收到后请求权威DNS服务器，询问www.server.com，权威DNS服务器给出域名解析的原出处，即IP地址</li> <li>本地DNS将IP地址返回客户端，客户端和目标建立连接</li></ol> <h3 id="arp"><a href="#arp" class="header-anchor">#</a> ARP</h3> <p>传输IP数据报时，确定了源IP地址和目标IP地址后，需要通过主机路由表依次转发，通过主机的路由表可以找到下一跳的IP地址，即通过ARP协议求得下一跳的MAC地址</p> <p><strong>@ 通过ARP查找MAC地址</strong></p> <p>ARP借助ARP请求和ARP响应两种类型的包确定MAC地址：</p> <ul><li>主机通过广播发送ARP请求，广播内容包括想知道的MAC地址的主机IP地址</li> <li>同个链路的所有设备收到ARP请求时，会拆开ARP请求包查看目标IP地址是否和自己的IP一致，一致则把自己的MAC地址塞入ARP响应包给主机</li></ul> <p>os通常会缓存MAC地址，不过这个缓存有一定期限，超过则清除</p> <p><strong>@ RARP协议</strong></p> <p>ARP是通过IP求MAC，RARP是通过MAC求IP地址，例如打印机等小型嵌入式设备接入网络时会用到</p> <p>通常需要架设一台RARP服务器，对于新加入的设备：</p> <ul><li>新加入的设备发送MAC地址请求IP的请求信息</li> <li>RARP服务器收到后返回MAC地址对应的IP地址的信息给设备</li> <li>设备根据收到的应答信息设置自己的IP</li></ul> <h3 id="dhcp"><a href="#dhcp" class="header-anchor">#</a> DHCP</h3> <p>个人电脑通过DHCP动态获取IP地址，省去了配IP信息繁琐的过程</p> <p>DHCP客户端监听68号端口，DHCP服务端监听67号端口</p> <ol><li>客户端发起DHCP发现报文的IP数据报，（客户端没有IP地址，也不知道DHCP服务器的地址），所以使用UDP广播通信，目的地址是255.255.255.255：67，源IP地址是0.0.0.0：68。DHCP客户端把该IP数据报传递给链路层，链路层将帧广播到网络</li> <li>DHCP服务器收到DHCP发现报文时，回复报文，携带IP广播地址255.255.255.255，带租约的IP地址、子网掩码、默认网关、DNS服务器</li> <li>客户端收到多个服务器的DHCP报文，选择一个发送请求报文，包含配置参数</li> <li>服务用DHCP ACK报文对DHCP请求报文响应，应答参数</li></ol> <p>此时客户端在租约内可使用DHCP服务器分配的IP地址</p> <p>如果租约的DHCP IP地址快过期了，客户端会向服务器发送DHCP请求报文</p> <ul><li>服务器同意继续租用，则用DHCP ACK报文进行应答，则客户端延长租期</li> <li>服务器如果不同意，则用DHCP NACK报文，客户端则停止使用该IP</li></ul> <p>DHCP全程使用UDP广播通信，如果服务端和客户端不在一个局域网内，则需要DHCP中继代理，不同网段的IP地址也可以由一个DHCP服务器同一分配管理</p> <ul><li>DHCP客户端以广播的形式发送DHCP请求包给DHCP中继代理，DHCP中继代理以单播的形式发给DHCP服务器</li> <li>DHCP服务器收到包后向DHCP中继代理返回应答，再转给DHCP客户端</li></ul> <h3 id="nat网络地址转换"><a href="#nat网络地址转换" class="header-anchor">#</a> NAT网络地址转换</h3> <p>IPv4地址紧张，因此提出网络地址转换NAT，缓解IPv4地址耗尽的问题</p> <p>同个公司、家庭、教室内的主机对外部通信时，把私有IP转为公有IP，把IP地址+端口号一起转换，即<strong>网络地址与端口转换</strong>NAPT</p> <p>两个私有IP地址同时发出请求时，路由器将两个不同的私有IP地址转换为同一个公有地址的不同端口号，并在NAPT转换表记录，当连接断开时，从表中删除这条记录</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231220112501455.png" alt="image-20231220112501455"></p> <p>缺点：</p> <ul><li>外部无法主动和NAT内部服务器建立连接，因为NAPT转换表没有转换记录</li> <li>转换表的生成和维护产生性能开销</li> <li>通信时NAT路由器重启，则TCP连接重置</li></ul> <p><strong>NAT穿透技术</strong></p> <p>应用程序主动建立好映射，从NAT设备获取公有IP地址，自己建立端口映射条目，用这个条目对外通信</p> <h3 id="icmp互联网控制报文协议"><a href="#icmp互联网控制报文协议" class="header-anchor">#</a> ICMP互联网控制报文协议</h3> <p>当网络包在复杂的网络传输中遇到问题时将由ICMP负责通知</p> <p>ICMP主要功能：确认IP包能否成功送达目标地址、报告发送过程中IP包被废弃的原因和改善网络设置等</p> <p>例：</p> <p>主机A向主机B发送了数据包，由于一些原因，途中的路由器未能发现主机B的存在，这时，路由器会向主机A发送一个ICMP目标不可达数据包，说明发送不成功（这种通知消息会使用IP进行发送）</p> <h4 id="icmp报头格式"><a href="#icmp报头格式" class="header-anchor">#</a> <strong>ICMP报头格式</strong></h4> <p>封装在IP包里，工作在网络层</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231221104604358.png" alt="image-20231221104604358"></p> <h4 id="查询报文类型"><a href="#查询报文类型" class="header-anchor">#</a> <strong>查询报文类型</strong></h4> <p>用于诊断的查询消息</p> <table><thead><tr><th>0</th> <th>回送应答</th> <th>查询报文类型</th></tr></thead> <tbody><tr><td>3</td> <td>目标不可达</td> <td>差错报文类型</td></tr> <tr><td>4</td> <td>原点抑制</td> <td>差错报文类型</td></tr> <tr><td>5</td> <td>重定向或改变路由</td> <td>差错报文类型</td></tr> <tr><td>8</td> <td>回送请求</td> <td>查询报文类型</td></tr> <tr><td>11</td> <td>超时</td> <td>差错报文类型</td></tr></tbody></table> <p><strong>回送消息</strong>用于进行通信的主机或路由器之间，用于判断所发送的数据报是否到达对端</p> <p><img src="/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%5C%E5%9F%BA%E7%A1%80/image-20231221105235965.png" alt="image-20231221105235965"></p> <p><strong>标识符</strong>用于区分是哪个应用程序发的ICMP包，常用进程PID作为标识符</p> <p><strong>序号</strong>从0开始，每发送一次新的回送请求就会加1，用来确认网络包是否丢失</p> <p><strong>选项数据</strong>中，还会存放请求的时间值用于计算往返时间</p> <h4 id="差错报文类型"><a href="#差错报文类型" class="header-anchor">#</a> <strong>差错报文类型</strong>：</h4> <p>用于通知出错原因的错误消息</p> <p><strong>@ 目标不可达消息</strong></p> <p>无法将IP数据包发给目标地址时，会给发送端主机返回一个目标不可达的ICMP消息，原因记录在ICMP包头的代码字段</p> <p>代码字段包括：</p> <ul><li>0 网络不可达，IP分为网络号和主机号，网络号不匹配时则是这个报错，不再有网络分类后，这个渐渐不使用了</li> <li>1 主机不可达，路由表没有该主机的信息或主机没有连接到网络</li> <li>2 协议不可达，对端防火墙禁止TCP访问，则使用TCP的方式会返回这个报错</li> <li>3 端口不可达，对端主机没有进程监听8080端口</li> <li>4 需要分片但设置了不分片，需要超过MTU大小的包时则丢弃并告知发送端</li></ul> <p><strong>@ 原点抑制消息</strong></p> <p>使用低速广域线路时，连接WAN的路由器可能遇到网络拥堵，</p> <p>当路由器向低速线路发送数据时，其发送队列的缓存变为0而无法发送出去时，可以向IP包的源地址发送一个ICMP原点抑制消息</p> <p>主机收到这个消息后，可以增大IP包的传输间隔，减少网络拥堵</p> <p>然而，这可能产生不公平的网络通信，因此一般不用</p> <p><strong>@ 重定向消息</strong></p> <p>如果路由器发现发送端主机使用了不是最优的路径发送数据，那么它会返回一个ICMP重定向消息给主机</p> <p>消息中包含了最合适的路由信息和源数据</p> <p><strong>@ 超时消息</strong></p> <p>IP包中的TTL字段，它的值随着每经过一次路由器就会减1，直到减到0时该IP包会被丢弃，此时路由器会发送一个ICMP超时消息给发送端主机</p> <p>这个TTL字段的目的是为了避免在路由控制中出现循环的情况，避免IP包无休止的在网络上被转发</p> <p>有时可以将TTL设置为一个较小的值，来控制包到达的范围</p> <h4 id="ping的工作原理"><a href="#ping的工作原理" class="header-anchor">#</a> ping的工作原理</h4> <p>IP协议基于ICMP协议实现</p> <ol><li><p>ping命令执行时，源主机首先会构建一个ICMP回送请求消息数据包</p> <p>ICMP数据包内包含类型（回送请求为8）、序号（区分连续的ping）、发送时间</p> <p>ICMP协议将这个数据包连同目标地址一起交给IP层，协议字段为1标识是ICMP协议，再加上其他控制信息构建成IP数据包</p></li> <li><p>加入MAC头，</p> <p>如果本地ARP映射表中查找出IP地址对应的MAC地址则直接使用，没有则发送ARP协议查询MAC地址，</p> <p>获得MAC地址后，由数据链路层构建一个数据帧，加上控制信息，传送出去</p></li> <li><p>主机B收到数据帧后，先检查MAC地址和本机地址对比，符合则接收，否则丢弃</p> <p>从帧中提取数据包给本机的IP层，IP检查后将信息提取给ICMP协议</p></li> <li><p>主机B构建一个ICMP回送响应消息数据包，</p> <p>ICMP回送响应包包含类型（回送响应为0）、序号（发来的序号）</p></li></ol> <p>ping和TCP都是用socket函数实现，只是TCP发送数据时报头不同，一个是ICMP头，一个是TCP头</p> <h4 id="traceroute-差错报文类型的使用"><a href="#traceroute-差错报文类型的使用" class="header-anchor">#</a> traceroute——差错报文类型的使用</h4> <p>traceroute（unix、macos），tracert（windows）</p> <p><strong>作用一</strong>：设置特殊的TTL，追踪来去目的时经过的路由器</p> <p><code>traceroute 192.168.1.100</code></p> <p>它的原理就是将TTL设置为1，遇到第一个路由就返回差错报文网络，再将TTL设置为2，遇到第二个路由返回差错报文网络，如此反复直到到达目的主机，从而拿到所有路由器的IP</p> <p><strong>作用二</strong>：故意设置不分片，从而确定路径的MTU</p> <p>有时不确定路由器的MTU大小，以太网一般1500字节，非以太网不确定</p> <p>在发送端主机发送IP数据报时，将IP包首部的分片禁止标志设为1，发送端每次收到ICMP差错报文时就减少包的大小，以此来定位一个合适的MTU值</p> <h3 id="igmp因特网组管理协议"><a href="#igmp因特网组管理协议" class="header-anchor">#</a> IGMP因特网组管理协议</h3> <p>组播地址可以给一组的地址发送数据，如果管理一组需要IGMP协议</p> <p>IGMP工作在主机和最后一跳路由之间</p> <p>主机发送IGMP报文申请加入到组播组时，路由器记录IGMP路由表，路由器后续就会转发组播包到对应的主机，如果不加入，默认路由器不会转发组播包到连接中的主机</p> <p>IGMP报文采用IP封装，IP头部的协议为2，TTL字段通常为1，因为IGMP是工作在主机和连接的路由器之间</p> <p><strong>IGMP工作机制</strong></p> <p>IGMP分为，IGMPv1，IGMPv2，IGMPv3</p> <p><strong>常规查询和响应工作机制</strong></p> <p>IGMPv2下</p> <ol><li><p>路由器周期性发送<strong>IGMP常规查询报文</strong>给特定组播地址224.0.0.1</p></li> <li><p>主机收到查询，如果本地有对应的组播组成员，则发送<strong>IGMP成员关系报告报文</strong>（源IP为自己主机的IP，目的IP为组播地址）</p> <p>这种发送是通过启动延迟计时器（随机0-10s），超时后就会发，如果在定时器超时之前，收到同一组内其他主机发出的成员关系报告报文，则自己不发送，这样可以减少整个组内的网络数量</p></li> <li><p>路由器收到主机成员关系报文后，在IGMP路由表中加入该组播组，</p></li></ol> <p><strong>离开组播组工作机制</strong></p> <ol><li>主机发送离组报文给224.0.0.2</li> <li>路由器收到报文后，以1s为间隔连续发送<strong>IGMP特定组查询报文</strong>（共计发送2个），以便确认该网络是否还有224.1.1.1组的其他成员</li> <li>如果有主机是这个特定组的成员则立即响应</li> <li>路由器收到后，则继续向该网络转发组播数据包。如果没有其他成员了，则停止转发该组播地址的数据包</li></ol> <h3 id="为什么断网还能ping通127-0-0-1"><a href="#为什么断网还能ping通127-0-0-1" class="header-anchor">#</a> 为什么断网还能ping通127.0.0.1</h3> <p>ping命令执行时，从应用层到传输层到网络层，这段路径和ping外网一样，到了网络层，系统会根据目的IP在路由表中获取对应的路由信息，包括选择哪个网卡把消息发出</p> <p>当发现目标IP是外网IP就从真网卡发出，当目标IP是回环地址时，就选择本地网卡</p> <p>本地网卡是个假网卡，有个input_pkt_queue的链表中挂者发给本地的各自消息，消息发到这个链表会触发有个软中断，内核线程ksoftirqd会负责取出消息，顺着数据链路层、网络层层层上层给应用程序</p> <p>如果主机负载大，可能ping127.0.0.1会失败</p> <p><strong>@ ping回环地址和ping本机地址有什么区别</strong></p> <p>没有区别，都不会发送到网络中</p> <p><strong>@ 127.0.0.1和localhost和0.0.0.0</strong></p> <p>localhost是个域名，等同于网址，默认会把他解析为127.0.0.1，可以在/etc/hosts文件下修改</p> <p>ping0.0.0.0是不行的，它在IPv4中表示的是无效地址。</p> <p>当启动服务器时，一般会listen一个IP和端口，等待客户端的连接，如果listen的是本机的0.0.0.0，表示本机上所有IPv4地址。此时用127.0.0.1和192.168.31.6都能访问到这个服务器。当然客户端connect时，不能使用0.</p> <h1 id="方"><a href="#方" class="header-anchor">#</a> 方</h1> <p>NAT模式：实现私有ip地址和公有ip地址的转换，使得通过一个公共IP地址访问一个局域网下的多个设备</p> <p>TUN模式：虚拟网络接口方式，常用于虚拟机、容器连接到其他虚拟网络</p> <p>DR模式：使用虚拟MAC地址请求实际机器，修改为目的地的mac地址，使真实物理服务器集群所有机器虚拟ip和负载均衡服务器ip地址一样，这种方式为直径路由方式</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/liang9886703/edit/master/docs/07.网络编程/01.基础/01.IP.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/02/13, 23:35:20</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/07/01/02/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">TCP</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/07/01/02/">TCP</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/02/01/"><div>
            一致性算法
            <!----></div></a> <span class="date">02-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/01/01/"><div>
            vim
            <!----></div></a> <span class="date">02-13</span></dt></dl><dl><dd>03</dd> <dt><a href="/02/02/"><div>
            分布式ID生成
            <!----></div></a> <span class="date">02-13</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:liang9886703@outlook.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/liang9886703" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2025-2025
    <span>松垮垮 | <a href="https://github.com/liang9886703/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a> | <a href="http://beian.miit.gov.cn/" target="_blank">蜀ICP备2025120453号</a> | <img src="/img/beian.png" style="width: 15px; margin-bottom: -3px;" /> <a href="https://beian.mps.gov.cn/#/query/webSearch?code=51011202000997" rel="noreferrer" target="_blank">川公网安备51011202000997号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          纯净模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center  top / 90% 90% no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.41210a84.js" defer></script><script src="/assets/js/2.ddcc22d9.js" defer></script><script src="/assets/js/3.9a514af0.js" defer></script><script src="/assets/js/35.a1680b5b.js" defer></script>
  </body>
</html>
